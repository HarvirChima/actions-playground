# =============================================================================
# 04 - REPOSITORY DISPATCH
# =============================================================================
# ðŸŽ¯ PURPOSE: Demonstrates how to trigger workflows from EXTERNAL sources
# using GitHub's repository_dispatch API. This enables integration with
# external systems, webhooks, and custom automation.
#
# ðŸ“š KEY CONCEPTS COVERED:
#   â€¢ repository_dispatch trigger
#   â€¢ Custom event types
#   â€¢ Receiving payload data from API calls
#   â€¢ Conditional execution based on event type
#
# ðŸ”Œ USE CASES:
#   â€¢ Trigger from external CI/CD systems (Jenkins, CircleCI, etc.)
#   â€¢ Webhook integration from third-party services
#   â€¢ Cross-repository workflow triggering
#   â€¢ ChatOps (trigger deployments from Slack/Discord)
#   â€¢ IoT or monitoring systems triggering actions
#
# ðŸš€ HOW TO TRIGGER THIS WORKFLOW:
#
#   Using curl (replace YOUR_GITHUB_TOKEN with a PAT with 'repo' scope):
#   
#   curl -X POST \
#     -H "Accept: application/vnd.github.v3+json" \
#     -H "Authorization: token YOUR_GITHUB_TOKEN" \
#     https://api.github.com/repos/OWNER/REPO/dispatches \
#     -d '{"event_type":"custom-event","client_payload":{"message":"Hello!"}}'
#
#   Using GitHub CLI:
#
#   gh api repos/OWNER/REPO/dispatches \
#     -F event_type=custom-event \
#     -F client_payload[message]="Hello from CLI"
#
# ðŸ“– For more details, see: docs/repository-dispatch-example.md
# =============================================================================

name: 04 - Repository Dispatch

on:
  # REPOSITORY_DISPATCH TRIGGER
  # This trigger activates when a POST request is sent to the dispatches API.
  # Unlike push/pull_request, this workflow waits for external API calls.
  repository_dispatch:
    # TYPES: Filter which event types this workflow responds to.
    # Only dispatch events with event_type matching these values will trigger.
    # You define these names - they can be anything meaningful to your system.
    types: [custom-event, webhook-event]

jobs:
  repository-dispatch-job:
    name: Repository Dispatch Job
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # -----------------------------------------------------------------------
      # ACCESSING DISPATCH EVENT DATA
      # -----------------------------------------------------------------------
      # The dispatch event includes:
      #   â€¢ github.event.action - The event_type from the API call
      #   â€¢ github.event.client_payload - Custom JSON data from the API call
      #
      # The 'toJson()' function converts objects to JSON strings for display.
      - name: Display event information
        run: |
          echo "Dispatch event type: ${{ github.event.action }}"
          echo "Event payload:"
          echo '${{ toJson(github.event.client_payload) }}'
          
      # -----------------------------------------------------------------------
      # CONDITIONAL EXECUTION BY EVENT TYPE
      # -----------------------------------------------------------------------
      # Use 'if' conditions to run different logic based on the event type.
      # This allows one workflow to handle multiple types of external triggers.
      - name: Process custom event
        if: github.event.action == 'custom-event'
        run: |
          echo "Processing custom event..."
          echo "This could trigger a deployment, run tests, etc."
          
      - name: Process webhook event
        if: github.event.action == 'webhook-event'
        run: |
          echo "Processing webhook event..."
          echo "This could handle external service notifications"
