# 11 - BEST PRACTICES
# Security: minimal permissions, pin versions, never expose secrets
# Performance: caching, matrix builds, concurrency, path filters
# Maintainability: meaningful names, reusable workflows, grouped commands

name: 11 - Best Practices

on:
  push:
    branches: [ main, copilot/** ]
  workflow_dispatch:

# PERMISSIONS - least privilege principle
permissions:
  contents: read

# GLOBAL ENV VARS - available to all jobs/steps
env:
  PROJECT_NAME: actions-playground
  BUILD_NUMBER: ${{ github.run_number }}

jobs:
  best-practices-demo:
    name: Best Practices Demonstration
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # PIN VERSIONS: @v4 (major), @v4.0.0 (exact), @sha (secure)
      - name: Setup Node.js (pinned version)
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      # ENV VARS - global and step-level
      - name: Use environment variables
        env:
          LOCAL_VAR: local-value
        run: |
          echo "Project: $PROJECT_NAME"
          echo "Build: $BUILD_NUMBER"
          echo "Local: $LOCAL_VAR"
          
      # CONDITIONALS - control step execution
      - name: Run only on main branch
        if: github.ref == 'refs/heads/main'
        run: echo "This runs only on main branch"
        
      - name: Run only on pull requests
        if: github.event_name == 'pull_request'
        run: echo "This runs only on pull requests"
        
      # OUTPUTS - pass data between steps via GITHUB_OUTPUT
      - name: Set output
        id: vars
        run: |
          echo "timestamp=$(date +%s)" >> $GITHUB_OUTPUT
          echo "short-sha=$(echo ${{ github.sha }} | cut -c1-7)" >> $GITHUB_OUTPUT
          
      - name: Use output
        run: |
          echo "Timestamp: ${{ steps.vars.outputs.timestamp }}"
          echo "Short SHA: ${{ steps.vars.outputs.short-sha }}"
          
      # ERROR HANDLING - continue-on-error for non-critical steps
      - name: Continue on error example
        continue-on-error: true
        run: exit 0
          
      - name: Build application for production
        run: echo "Building..."
          
      # GROUP RELATED COMMANDS
      - name: Display all environment info
        run: |
          echo "OS: $(uname -s)"
          echo "Runner: ${{ runner.os }}"
          echo "Event: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          
  security-best-practices:
    name: Security Best Practices
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Security considerations
        run: |
          echo "1. Pin actions to SHA or specific tags"
          echo "2. Never expose secrets in logs"
          echo "3. Use CODEOWNERS for workflow files"
          echo "4. Limit permissions with 'permissions:' key"
          echo "5. Use environments for protection rules"
          echo "6. Review third-party actions before use"
          
  performance-best-practices:
    name: Performance Best Practices
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Performance tips
        run: |
          echo "1. Use caching for dependencies"
          echo "2. Use matrix builds for parallel execution"
          echo "3. Use concurrency to cancel outdated runs"
          echo "4. Use path filters to skip unnecessary runs"
