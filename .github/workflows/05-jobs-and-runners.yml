# =============================================================================
# 05 - MULTIPLE JOBS AND RUNNERS
# =============================================================================
# üéØ PURPOSE: Demonstrates how to structure workflows with multiple jobs,
# use different operating system runners, and leverage matrix strategy for
# parallel testing across multiple configurations.
#
# üìö KEY CONCEPTS COVERED:
#   ‚Ä¢ Multiple jobs (parallel by default)
#   ‚Ä¢ Different runner types (Ubuntu, Windows, macOS)
#   ‚Ä¢ Job dependencies with 'needs'
#   ‚Ä¢ Matrix strategy for parallel execution
#
# üñ•Ô∏è GITHUB-HOSTED RUNNERS:
#   GitHub provides free runners with common operating systems:
#
#   Linux:
#   ‚Ä¢ ubuntu-latest (currently Ubuntu 22.04)
#   ‚Ä¢ ubuntu-22.04, ubuntu-20.04
#
#   Windows:
#   ‚Ä¢ windows-latest (currently Windows Server 2022)
#   ‚Ä¢ windows-2022, windows-2019
#
#   macOS:
#   ‚Ä¢ macos-latest (currently macOS 14)
#   ‚Ä¢ macos-14, macos-13, macos-12
#
#   Each runner comes pre-installed with common tools and SDKs.
#   See: https://github.com/actions/runner-images for full details.
#
# üîó JOB EXECUTION ORDER:
#   ‚Ä¢ By default, jobs run in PARALLEL (simultaneously)
#   ‚Ä¢ Use 'needs: job-id' to create dependencies (sequential execution)
#   ‚Ä¢ Jobs can depend on multiple other jobs: needs: [job1, job2]
# =============================================================================

name: 05 - Multiple Jobs and Runners

on:
  push:
    branches: [ main, copilot/** ]
  workflow_dispatch:  # Allow manual triggering for demos

jobs:
  # ===========================================================================
  # JOB 1: UBUNTU RUNNER
  # ===========================================================================
  # This job runs on Ubuntu Linux, the most common runner for CI/CD.
  ubuntu-job:
    name: Ubuntu Runner
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # Display OS information using Linux commands
      - name: Display OS info
        run: |
          echo "Running on Ubuntu"
          uname -a
          lsb_release -a
          
  # ===========================================================================
  # JOB 2: WINDOWS RUNNER
  # ===========================================================================
  # This job runs on Windows Server. Note: shell commands are different!
  # Windows uses PowerShell by default, or you can specify 'shell: bash'.
  windows-job:
    name: Windows Runner
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # Display OS information using Windows commands (PowerShell)
      - name: Display OS info
        run: |
          echo "Running on Windows"
          systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
          
  # ===========================================================================
  # JOB 3: MACOS RUNNER
  # ===========================================================================
  # This job runs on macOS. Useful for building iOS apps or macOS-specific tools.
  # Note: macOS runners typically have higher queue times.
  macos-job:
    name: macOS Runner
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # Display OS information using macOS commands
      - name: Display OS info
        run: |
          echo "Running on macOS"
          sw_vers
          
  # ===========================================================================
  # JOB 4: DEPENDENT JOB (SEQUENTIAL EXECUTION)
  # ===========================================================================
  # The 'needs' keyword creates a dependency on another job.
  # This job will only run AFTER 'ubuntu-job' completes successfully.
  # If ubuntu-job fails, this job is automatically skipped.
  dependent-job:
    name: Dependent Job
    runs-on: ubuntu-latest
    needs: ubuntu-job  # ‚Üê This is the key! Wait for ubuntu-job to finish
    
    steps:
      - name: Display dependency info
        run: |
          echo "This job runs after ubuntu-job completes"
          echo "Useful for deployment pipelines"
          
  # ===========================================================================
  # JOB 5: MATRIX STRATEGY (PARALLEL TESTING)
  # ===========================================================================
  # Matrix strategy creates multiple job instances with different configurations.
  # GitHub automatically runs all combinations in parallel!
  #
  # In this example:
  #   ‚Ä¢ 2 operating systems √ó 2 Node versions = 4 parallel jobs
  #   ‚Ä¢ Each combination runs independently
  #
  # This is extremely powerful for:
  #   ‚Ä¢ Testing across multiple OS versions
  #   ‚Ä¢ Testing across multiple language/runtime versions
  #   ‚Ä¢ Testing across different configurations
  matrix-job:
    name: Matrix - ${{ matrix.os }} / Node ${{ matrix.node }}
    # The 'matrix.os' value is used dynamically for runs-on
    runs-on: ${{ matrix.os }}
    
    # STRATEGY: Define the matrix of configurations to test
    strategy:
      matrix:
        # Each array creates a dimension of the matrix
        os: [ubuntu-latest, windows-latest]  # 2 operating systems
        node: [18, 20]                        # 2 Node.js versions
        # Result: 2 √ó 2 = 4 job instances running in parallel!
        
        # You can also add 'include' to add specific combinations:
        # include:
        #   - os: ubuntu-latest
        #     node: 21
        #     experimental: true
        
        # Or 'exclude' to skip specific combinations:
        # exclude:
        #   - os: windows-latest
        #     node: 18
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # Use setup-node action with the matrix node version
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}  # Uses the current matrix value
          
      # Verify the versions are as expected
      - name: Display versions
        run: |
          node --version
          npm --version
