# =============================================================================
# 09 - CALLING REUSABLE WORKFLOWS
# =============================================================================
# üéØ PURPOSE: Demonstrates how to CALL reusable workflows to share common
# logic across multiple workflows without duplicating code.
#
# üìö KEY CONCEPTS COVERED:
#   ‚Ä¢ Calling reusable workflows with 'uses'
#   ‚Ä¢ Passing inputs to reusable workflows
#   ‚Ä¢ Receiving outputs from reusable workflows
#   ‚Ä¢ Passing secrets to reusable workflows
#
# üîÑ WHAT ARE REUSABLE WORKFLOWS?
#   Reusable workflows are standalone workflow files that can be "called" by
#   other workflows, similar to how functions work in programming.
#
#   Benefits:
#   ‚Ä¢ DRY (Don't Repeat Yourself) - Write once, use many times
#   ‚Ä¢ Consistency - Same logic runs across all calling workflows
#   ‚Ä¢ Easier maintenance - Update one file, all callers get the change
#   ‚Ä¢ Separation of concerns - Keep complex logic in dedicated files
#
# üìÅ FILE STRUCTURE:
#   This file (09-reusable-workflow.yml) - The CALLER workflow
#   reusable-build.yml - The CALLED (reusable) workflow
#
# üîó WORKFLOW HIERARCHY:
#   1. This workflow triggers on push/workflow_dispatch
#   2. This workflow calls reusable-build.yml with different inputs
#   3. reusable-build.yml runs and returns outputs
#   4. This workflow uses those outputs
# =============================================================================

name: 09 - Call Reusable Workflow

on:
  push:
    branches: [ main, copilot/** ]
  workflow_dispatch:

jobs:
  # ===========================================================================
  # CALL REUSABLE WORKFLOW (DEV CONFIGURATION)
  # ===========================================================================
  # Use 'uses' with a path to call a reusable workflow.
  # This is different from calling an action - workflows use full file paths.
  call-reusable-dev:
    name: Call Reusable Workflow (Dev)
    # CALLING A REUSABLE WORKFLOW:
    # - Use relative path for workflows in the same repository
    # - Format: ./.github/workflows/workflow-name.yml
    # - For external repos: owner/repo/.github/workflows/workflow.yml@ref
    uses: ./.github/workflows/reusable-build.yml
    # PASSING INPUTS:
    # Use 'with' to pass values to the reusable workflow's inputs.
    # Input names must match what's defined in the reusable workflow.
    with:
      environment: dev
      node-version: '18'
      
  # ===========================================================================
  # CALL REUSABLE WORKFLOW (PRODUCTION CONFIGURATION)
  # ===========================================================================
  # Same workflow, different inputs - demonstrates the reusability.
  call-reusable-prod:
    name: Call Reusable Workflow (Prod)
    uses: ./.github/workflows/reusable-build.yml
    with:
      environment: production
      node-version: '20'
    # PASSING SECRETS (uncomment to use):
    # Secrets must be explicitly passed - they're not inherited automatically.
    # secrets:
    #   deploy-token: ${{ secrets.PROD_DEPLOY_TOKEN }}
      
  # ===========================================================================
  # USING OUTPUTS FROM REUSABLE WORKFLOWS
  # ===========================================================================
  # Reusable workflows can return outputs that you can use in subsequent jobs.
  use-outputs:
    name: Use Reusable Workflow Outputs
    # 'needs' ensures this job waits for the reusable workflow to complete
    needs: call-reusable-dev
    runs-on: ubuntu-latest
    
    steps:
      # ACCESS OUTPUTS from the reusable workflow using:
      # needs.<job-id>.outputs.<output-name>
      - name: Display outputs
        run: |
          echo "Build status from reusable workflow: ${{ needs.call-reusable-dev.outputs.build-status }}"
          echo "Reusable workflows help with:"
          echo "  - DRY principle (Don't Repeat Yourself)"
          echo "  - Consistency across workflows"
          echo "  - Easier maintenance"
          echo "  - Centralized logic"
