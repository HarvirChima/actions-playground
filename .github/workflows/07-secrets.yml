# =============================================================================
# 07 - USING SECRETS
# =============================================================================
# üéØ PURPOSE: Demonstrates how to securely handle sensitive data like API keys,
# passwords, and tokens using GitHub Secrets.
#
# üìö KEY CONCEPTS COVERED:
#   ‚Ä¢ Repository secrets vs environment secrets
#   ‚Ä¢ Accessing secrets in workflows
#   ‚Ä¢ Automatic secret masking in logs
#   ‚Ä¢ Security best practices
#
# üîê TYPES OF SECRETS:
#
#   1. REPOSITORY SECRETS (Settings ‚Üí Secrets ‚Üí Actions)
#      ‚Ä¢ Available to all workflows in the repository
#      ‚Ä¢ Accessed via: ${{ secrets.SECRET_NAME }}
#
#   2. ENVIRONMENT SECRETS (Settings ‚Üí Environments ‚Üí [env] ‚Üí Secrets)
#      ‚Ä¢ Available only to jobs with 'environment: [env-name]'
#      ‚Ä¢ Can have different values per environment (dev, staging, prod)
#      ‚Ä¢ Can require approvals before accessing
#
#   3. ORGANIZATION SECRETS (Org Settings ‚Üí Secrets)
#      ‚Ä¢ Shared across multiple repositories in an organization
#      ‚Ä¢ Can be scoped to specific repos or all repos
#
# ‚ö†Ô∏è SECURITY BEST PRACTICES:
#   ‚Ä¢ NEVER commit secrets to your repository
#   ‚Ä¢ Use secrets for ALL sensitive data (API keys, passwords, tokens)
#   ‚Ä¢ Rotate secrets regularly
#   ‚Ä¢ Use environment protection rules for production secrets
#   ‚Ä¢ Limit who can create/modify secrets
#   ‚Ä¢ Review workflow logs to ensure secrets aren't accidentally exposed
# =============================================================================

name: 07 - Using Secrets

on:
  # workflow_dispatch allows us to select which environment to use
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to use'
        required: true
        type: choice
        options:
          - dev
          - staging
          - production

jobs:
  use-secrets:
    name: Use Secrets Example
    runs-on: ubuntu-latest
    
    # -------------------------------------------------------------------------
    # ENVIRONMENTS
    # -------------------------------------------------------------------------
    # The 'environment' key associates this job with a GitHub Environment.
    # Environments can have:
    #   ‚Ä¢ Environment-specific secrets
    #   ‚Ä¢ Protection rules (required reviewers, wait timers)
    #   ‚Ä¢ Deployment branch restrictions
    #
    # Create environments at: Settings ‚Üí Environments ‚Üí New environment
    environment: ${{ inputs.environment }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # -----------------------------------------------------------------------
      # ACCESSING SECRETS
      # -----------------------------------------------------------------------
      # Secrets are accessed using the ${{ secrets.SECRET_NAME }} syntax.
      # In this demo, we're showing the concept without actual secrets.
      - name: Use repository secret (demo)
        run: |
          echo "Accessing secrets in GitHub Actions"
          echo "Note: Secrets are automatically masked in logs"
          # In real usage: echo "${{ secrets.MY_SECRET }}"
          # The secret value will be replaced with *** in logs
          
      # -----------------------------------------------------------------------
      # SECRET MASKING
      # -----------------------------------------------------------------------
      # GitHub automatically masks (hides) secret values in logs.
      # If you echo a secret, you'll see *** instead of the actual value.
      # This prevents accidental exposure in workflow logs.
      - name: Demonstrate secret masking
        run: |
          echo "If you print a secret, it will show as ***"
          echo "This protects sensitive data in workflow logs"
          
      # -----------------------------------------------------------------------
      # USING SECRETS IN SCRIPTS
      # -----------------------------------------------------------------------
      # Best practice: Pass secrets as environment variables to scripts.
      # This keeps them out of command-line arguments (which may be logged).
      - name: Use secret in script
        env:
          # Uncomment these lines and create the secrets to use them:
          # API_KEY: ${{ secrets.API_KEY }}
          # DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          ENV_NAME: ${{ inputs.environment }}
        run: |
          echo "Environment: $ENV_NAME"
          echo "In production, you would use secrets like:"
          echo "  - API keys for external services"
          echo "  - Database passwords"
          echo "  - Deployment tokens"
          echo "  - SSH keys"
          
      # -----------------------------------------------------------------------
      # SECRET BEST PRACTICES SUMMARY
      # -----------------------------------------------------------------------
      - name: Best practices for secrets
        run: |
          echo "Secret Best Practices:"
          echo "1. Never commit secrets to repository"
          echo "2. Use GitHub secrets for sensitive data"
          echo "3. Use environments for environment-specific secrets"
          echo "4. Rotate secrets regularly"
          echo "5. Use least privilege principle"
          echo "6. Consider using encrypted secrets at rest"
