# ============================================================================
# 07 - USING SECRETS
# ============================================================================
# This workflow demonstrates how to use GitHub Secrets to securely store and
# access sensitive data like API keys, passwords, and tokens in your workflows.
#
# KEY CONCEPTS:
# - Repository secrets: Available to all workflows in the repository
# - Environment secrets: Available only when a job references a specific environment
# - Organization secrets: Available across multiple repositories (org level)
# - Automatic masking: Secret values are automatically masked as *** in logs
#
# ============================================================================
# HOW TO CREATE SECRETS FOR THIS WORKFLOW:
# ============================================================================
#
# STEP 1: Navigate to your repository's Settings
#   - Go to your repository on GitHub
#   - Click the "Settings" tab at the top of the page
#
# STEP 2: Create Repository Secrets
#   - In the left sidebar, click "Secrets and variables" → "Actions"
#   - Click the "New repository secret" button
#   - Example secrets to create:
#     • Name: API_KEY          Value: your-api-key-here
#     • Name: DATABASE_URL     Value: your-database-connection-string
#     • Name: DEPLOY_TOKEN     Value: your-deployment-token
#
# STEP 3: (Optional) Create Environment-Specific Secrets
#   - In Settings, go to "Environments" in the left sidebar
#   - Create environments: "dev", "staging", "production"
#   - Click on an environment and add secrets specific to that environment
#   - Example: API_KEY in "production" could differ from API_KEY in "dev"
#
# IMPORTANT: Never commit actual secret values to your repository!
# ============================================================================

name: 07 - Using Secrets

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to use'
        required: true
        type: choice
        options: [dev, staging, production]

jobs:
  use-secrets:
    name: Use Secrets Example
    runs-on: ubuntu-latest
    # The 'environment' key enables environment-specific secrets.
    # Secrets defined in the selected environment (dev/staging/production)
    # will be available to this job, overriding repository-level secrets
    # of the same name if they exist.
    environment: ${{ inputs.environment }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # ACCESS SECRETS: Use the syntax ${{ secrets.SECRET_NAME }}
      # Secret values are automatically masked as *** in workflow logs
      - name: Use repository secret (demo)
        run: |
          echo "Secrets are accessed via \${{ secrets.SECRET_NAME }}"
          echo "Example: \${{ secrets.API_KEY }} or \${{ secrets.DATABASE_URL }}"
          echo "Values are automatically masked in logs to prevent exposure"
          
      # BEST PRACTICE: Pass secrets as environment variables, not command arguments
      # Command arguments may appear in process listings and logs
      - name: Use secret in script
        env:
          # To use a secret, uncomment and set up the secret in your repository:
          # API_KEY: ${{ secrets.API_KEY }}
          # DATABASE_URL: ${{ secrets.DATABASE_URL }}
          ENV_NAME: ${{ inputs.environment }}
        run: |
          echo "Current environment: $ENV_NAME"
          echo "Common secret use cases:"
          echo "  - API keys for external services"
          echo "  - Database connection strings"
          echo "  - Deployment tokens"
          echo "  - SSH keys for server access"
          
      - name: Best practices for secrets
        run: |
          echo "=== SECRET SECURITY BEST PRACTICES ==="
          echo "1. Never commit secrets to your repository"
          echo "2. Use environment-specific secrets for different stages"
          echo "3. Rotate secrets regularly (at least every 90 days)"
          echo "4. Apply least privilege principle - only grant necessary access"
          echo "5. Use GitHub's built-in secret scanning to detect accidental commits"
          echo "6. Review who has access to secrets periodically"
