# =============================================================================
# 10 - COMPOSITE ACTIONS
# =============================================================================
# ðŸŽ¯ PURPOSE: Demonstrates how to use COMPOSITE ACTIONS - reusable bundles
# of steps that you can share across workflows.
#
# ðŸ“š KEY CONCEPTS COVERED:
#   â€¢ Using local composite actions from your repository
#   â€¢ Passing inputs to composite actions
#   â€¢ Receiving outputs from composite actions
#   â€¢ When to use composite actions vs reusable workflows
#
# ðŸ”§ WHAT ARE COMPOSITE ACTIONS?
#   Composite actions are custom actions defined in your repository that
#   bundle multiple steps into a single reusable unit.
#
#   Location: .github/actions/<action-name>/action.yml
#
#   Benefits:
#   â€¢ Package multiple steps into one action
#   â€¢ Share logic across workflows in the same repo
#   â€¢ Can be published to the Marketplace for others to use
#   â€¢ Simpler than reusable workflows for small tasks
#
# ðŸ“Š COMPOSITE ACTION vs REUSABLE WORKFLOW:
#
#   COMPOSITE ACTION:
#   â€¢ Located in: .github/actions/*/action.yml
#   â€¢ Called at STEP level: - uses: ./.github/actions/my-action
#   â€¢ Runs on the SAME runner as the calling workflow
#   â€¢ Contains only steps (no jobs)
#   â€¢ Best for: Small, focused tasks
#
#   REUSABLE WORKFLOW:
#   â€¢ Located in: .github/workflows/*.yml
#   â€¢ Called at JOB level: uses: ./.github/workflows/workflow.yml
#   â€¢ Can have its OWN runner
#   â€¢ Contains full jobs with steps
#   â€¢ Best for: Complex, multi-job pipelines
# =============================================================================

name: 10 - Composite Action

on:
  push:
    branches: [ main, copilot/** ]
  workflow_dispatch:

jobs:
  use-composite-action:
    name: Use Composite Action
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # -----------------------------------------------------------------------
      # USING A LOCAL COMPOSITE ACTION
      # -----------------------------------------------------------------------
      # Use a relative path to reference actions in your repository.
      # The path points to the directory containing action.yml (not the file itself).
      #
      # Our composite action 'greet-user' is located at:
      # .github/actions/greet-user/action.yml
      - name: Use custom composite action
        id: greet  # ID allows us to reference outputs from this step
        uses: ./.github/actions/greet-user
        with:
          # Pass inputs defined in the action's action.yml
          username: 'Demo User'
          greeting: 'Welcome'
          
      # -----------------------------------------------------------------------
      # USING OUTPUTS FROM COMPOSITE ACTIONS
      # -----------------------------------------------------------------------
      # Access outputs using: steps.<step-id>.outputs.<output-name>
      # The output names are defined in the action's action.yml file.
      - name: Display output from composite action
        run: |
          echo "Output from composite action: ${{ steps.greet.outputs.message }}"
          
      # -----------------------------------------------------------------------
      # REUSING WITH DIFFERENT INPUTS
      # -----------------------------------------------------------------------
      # Call the same action multiple times with different inputs.
      # This demonstrates the reusability of composite actions.
      - name: Use composite action with different inputs
        uses: ./.github/actions/greet-user
        with:
          username: 'Another User'
          greeting: 'Hi'
          
      # Summary of composite action benefits
      - name: Composite action benefits
        run: |
          echo "Composite Actions Benefits:"
          echo "1. Package multiple steps into reusable action"
          echo "2. Share common logic across workflows"
          echo "3. Simplify complex workflows"
          echo "4. Easier to maintain and update"
          echo "5. Can be published to marketplace"
